{% extends "base.html" %}

<!-- Load modern fonts -->
{% block extra_head %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}
<!-- Mobile Header -->
<div class="mobile-header d-block d-lg-none" style="background: #4a5568; padding: 12px 16px; position: fixed; top: 0; left: 0; right: 0; z-index: 1050; box-shadow: 0 2px 8px rgba(0,0,0,0.15);">
    <div class="d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center">
            <div class="brand-icon me-2" style="width: 28px; height: 28px; background: var(--brand-gradient); border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-layer-group" style="font-size: 12px; color: white;"></i>
            </div>
            <h4 style="margin: 0; font-size: 16px; font-weight: 600; color: #e2e8f0;">Dashboard</h4>
        </div>
        <button class="mobile-menu-toggle" data-bs-toggle="offcanvas" data-bs-target="#mobileSidebar" style="background: none; border: none; color: #e2e8f0; font-size: 18px; padding: 0; min-width: 44px; min-height: 44px; display: flex; align-items: center; justify-content: center; border-radius: 6px;">
            <i class="fas fa-bars"></i>
        </button>
    </div>
</div>

<!-- Mobile Body Padding -->
<div class="d-block d-lg-none" style="height: 60px;"></div>

<!-- Mobile Content Area (visible only on mobile) -->
<div class="mobile-content d-block d-lg-none" style="background: var(--bg-primary); min-height: calc(100vh - 60px); padding: 16px; margin-top: 60px;">
    <!-- Page Actions (mobile) -->
    <div class="d-flex justify-content-end mb-3">
        {% if self.page_actions() %}
            {{ self.page_actions() }}
        {% endif %}
    </div>
    
    <!-- Main Content (mobile) -->
    <div>
        {% if self.page_content() %}
            {{ self.page_content() }}
        {% endif %}
    </div>
</div>

<!-- Desktop Layout (hidden on mobile) -->
<div class="d-none d-lg-flex min-vh-100">
    <!-- Desktop Sidebar -->
    <nav class="sidebar-modern" style="width: 240px; min-height: 100vh; background: #4a5568; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
        <!-- Sidebar Brand -->
        <div class="sidebar-header" style="padding: 16px 20px; border-bottom: 1px solid rgba(255,255,255,0.1);">
            <div class="d-flex align-items-center">
                <div class="brand-icon me-2" style="width: 28px; height: 28px; background: var(--brand-gradient); border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-layer-group" style="font-size: 12px; color: white;"></i>
                </div>
                <h4 style="margin: 0; font-size: 16px; font-weight: 600; color: #e2e8f0;">Dashboard</h4>
            </div>
        </div>

        <!-- Navigation -->
        <div class="sidebar-nav" style="padding: 12px; {% if get_env_var('DISABLE_AUTH', 'false').lower() == 'true' %}padding-bottom: 100px;{% endif %}">
            <!-- Main Section -->
            <div class="nav-section" style="margin-bottom: 20px;">
                <h6 style="color: #a0aec0; font-weight: 600; font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; margin: 12px 12px 8px 12px;">MAIN</h6>
                <a href="{{ url_for('dashboard') }}" class="nav-item d-flex align-items-center text-decoration-none {% if request.endpoint == 'dashboard' %}nav-active{% endif %}" style="padding: 8px 12px; margin-bottom: 2px; border-radius: 6px; transition: all 0.15s ease; color: #cbd5e0; height: 36px;">
                    <i class="fas fa-home" style="width: 16px; margin-right: 12px; font-size: 13px;"></i>
                    <span style="font-weight: 500; font-size: 14px;">Dashboard</span>
                </a>
            </div>

            <!-- Section Divider -->
            <hr style="border: none; height: 1px; background: rgba(255,255,255,0.1); margin: 16px 12px;">

            <!-- Administration Section -->
            <div class="nav-section">
                <h6 style="color: #a0aec0; font-weight: 600; font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; margin: 8px 12px 8px 12px;">ADMINISTRATION</h6>
                <a href="{{ url_for('users') }}" class="nav-item d-flex align-items-center text-decoration-none {% if request.endpoint == 'users' %}nav-active{% endif %}" style="padding: 8px 12px; margin-bottom: 2px; border-radius: 6px; transition: all 0.15s ease; color: #cbd5e0; height: 36px;">
                    <i class="fas fa-users" style="width: 16px; margin-right: 12px; font-size: 13px;"></i>
                    <span style="font-weight: 500; font-size: 14px;">Users</span>
                </a>
            </div>
        </div>

        <!-- Authentication Disabled Warning -->
        {% if get_env_var('DISABLE_AUTH', 'false').lower() == 'true' %}
        <div class="position-absolute bottom-0 w-100 p-2">
            <div class="alert alert-danger mb-0 text-center" style="background: rgba(220, 53, 69, 0.9); border: 1px solid #dc3545; font-size: 10px; line-height: 1.2; padding: 8px;">
                <div class="fw-bold text-uppercase mb-1">
                    <i class="fas fa-exclamation-triangle me-1"></i>
                    DEV MODE
                </div>
                <div class="small">
                    Auth Disabled!<br>
                    <strong>DO NOT DEPLOY!</strong>
                </div>
            </div>
        </div>
        {% endif %}
    </nav>
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div class="flex-grow-1 d-flex flex-column" style="background: var(--bg-primary);">
        <!-- Metronic Light Topbar -->
        <nav class="topbar-modern" style="background: var(--bg-elevated); padding: 12px 20px; border-bottom: 1px solid var(--border-primary); height: 60px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
            <div class="d-flex justify-content-between align-items-center h-100">
                <!-- Page Title -->
                <div>
                    <h1 style="margin: 0; font-size: 18px; font-weight: 600; color: var(--text-primary);">{% block page_title %}Dashboard{% endblock %}</h1>
                </div>

                <!-- User Profile -->
                <div class="dropdown">
                    <button class="btn btn-link dropdown-toggle d-flex align-items-center text-decoration-none" 
                            type="button" id="userDropdown" data-bs-toggle="dropdown" style="padding: 4px 8px;">
                        <div class="avatar-circle text-white me-2" style="width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-size: 12px; font-weight: 600;">
                            {{ current_user.username[0].upper() if current_user.is_authenticated else 'U' }}
                        </div>
                        <span style="color: var(--text-primary); font-weight: 500; font-size: 14px; margin-right: 4px;" class="d-none d-md-inline">{{ current_user.username if current_user.is_authenticated else 'User' }}</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" style="box-shadow: 0 4px 16px rgba(0,0,0,0.1); border: 1px solid var(--border-primary); border-radius: 6px; min-width: 180px; background: var(--bg-elevated);">
                        <li><a class="dropdown-item" href="#" style="padding: 8px 16px; font-size: 14px;"><i class="fas fa-user me-2" style="font-size: 12px;"></i>Profile</a></li>
                        <li><a class="dropdown-item" href="#" style="padding: 8px 16px; font-size: 14px;"><i class="fas fa-cog me-2" style="font-size: 12px;"></i>Settings</a></li>
                        <li><hr class="dropdown-divider" style="margin: 4px 0; border-color: var(--border-primary);"></li>
                        <li><a class="dropdown-item" href="{{ url_for('logout') }}" style="padding: 8px 16px; font-size: 14px;"><i class="fas fa-sign-out-alt me-2" style="font-size: 12px;"></i>Logout</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        
        <!-- Main Content Area -->
        <div class="flex-grow-1 p-4">
            <div class="container-fluid">
                <!-- Page Actions (if any) -->
                <div class="d-flex justify-content-end mb-4">
                    {% block page_actions %}{% endblock %}
                </div>

                <!-- Main Content -->
                <div class="content-area">
                    {% block page_content %}{% endblock %}
                </div>
            </div>
        </div>
        
    </div>
</div>

<!-- Mobile Sidebar (Offcanvas) -->
<div class="offcanvas offcanvas-start d-lg-none" tabindex="-1" id="mobileSidebar" style="background: #4a5568; width: 280px;">
    <div class="offcanvas-header" style="padding: 16px 20px; border-bottom: 1px solid rgba(255,255,255,0.1);">
        <div class="d-flex align-items-center">
            <div class="brand-icon me-2" style="width: 28px; height: 28px; background: var(--brand-gradient); border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-layer-group" style="font-size: 12px; color: white;"></i>
            </div>
            <h4 style="margin: 0; font-size: 16px; font-weight: 600; color: #e2e8f0;">Dashboard</h4>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" style="filter: invert(1); opacity: 0.8;"></button>
    </div>
    <div class="offcanvas-body" style="padding: 0;">
        <!-- Mobile Navigation (Same as desktop) -->
        <div class="sidebar-nav" style="padding: 12px; {% if get_env_var('DISABLE_AUTH', 'false').lower() == 'true' %}padding-bottom: 100px;{% endif %}">
            <!-- Main Section -->
            <div class="nav-section" style="margin-bottom: 20px;">
                <h6 style="color: #a0aec0; font-weight: 600; font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; margin: 12px 12px 8px 12px;">MAIN</h6>
                <a href="{{ url_for('dashboard') }}" class="nav-item d-flex align-items-center text-decoration-none {% if request.endpoint == 'dashboard' %}nav-active{% endif %}" style="padding: 8px 12px; margin-bottom: 2px; border-radius: 6px; transition: all 0.15s ease; color: #cbd5e0; height: 36px;" data-bs-dismiss="offcanvas">
                    <i class="fas fa-home" style="width: 16px; margin-right: 12px; font-size: 13px;"></i>
                    <span style="font-weight: 500; font-size: 14px;">Dashboard</span>
                </a>
            </div>

            <!-- Section Divider -->
            <hr style="border: none; height: 1px; background: rgba(255,255,255,0.1); margin: 16px 12px;">

            <!-- Administration Section -->
            <div class="nav-section">
                <h6 style="color: #a0aec0; font-weight: 600; font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; margin: 8px 12px 8px 12px;">ADMINISTRATION</h6>
                <a href="{{ url_for('users') }}" class="nav-item d-flex align-items-center text-decoration-none {% if request.endpoint == 'users' %}nav-active{% endif %}" style="padding: 8px 12px; margin-bottom: 2px; border-radius: 6px; transition: all 0.15s ease; color: #cbd5e0; height: 36px;" data-bs-dismiss="offcanvas">
                    <i class="fas fa-users" style="width: 16px; margin-right: 12px; font-size: 13px;"></i>
                    <span style="font-weight: 500; font-size: 14px;">Users</span>
                </a>
            </div>
        </div>

        <!-- Mobile Authentication Warning -->
        {% if get_env_var('DISABLE_AUTH', 'false').lower() == 'true' %}
        <div class="position-absolute bottom-0 w-100 p-2">
            <div class="alert" style="background: rgba(255, 199, 0, 0.9); border: 1px solid #ffc700; border-radius: 6px; padding: 8px 12px; margin: 8px; font-size: 11px; color: #8B4513;">
                <i class="fas fa-exclamation-triangle me-1" style="font-size: 10px;"></i>
                <strong>DEV MODE:</strong> Auth disabled
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Command Palette Modal -->
<div class="modal fade" id="commandPalette" tabindex="-1" aria-hidden="true" style="backdrop-filter: blur(8px);">
    <div class="modal-dialog modal-dialog-centered" style="max-width: 600px;">
        <div class="modal-content" style="background: var(--bg-elevated); border: var(--glass-border); border-radius: var(--radius-xl); box-shadow: var(--shadow-xl); backdrop-filter: var(--glass-blur);">
            <div class="modal-header" style="border-bottom: 1px solid var(--border-primary); padding: var(--space-4) var(--space-6);">
                <div class="d-flex align-items-center w-100">
                    <i class="fas fa-search" style="color: var(--text-tertiary); margin-right: var(--space-3);"></i>
                    <input type="text" id="commandInput" class="form-control" placeholder="Type a command or search..." style="background: transparent; border: none; color: var(--text-primary); font-size: var(--text-base); outline: none; box-shadow: none;">
                    <div style="background: var(--bg-glass); color: var(--text-tertiary); padding: var(--space-1) var(--space-2); border-radius: var(--radius-sm); font-size: var(--text-xs); font-weight: var(--font-medium);">ESC</div>
                </div>
            </div>
            <div class="modal-body" id="commandResults" style="padding: 0; max-height: 400px; overflow-y: auto;">
                <!-- Command results will be populated here -->
            </div>
        </div>
    </div>
</div>

<!-- Modern Design System Styles -->
<style>
    /* Apply Inter font and dark theme globally */
    * {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        box-sizing: border-box;
    }
    
    body {
        background: var(--bg-primary);
        color: var(--text-primary);
        margin: 0;
        padding: 0;
        font-size: 14px;
        line-height: 1.5;
        font-weight: 400;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
    
    /* Metronic Professional Light Theme */
    :root {
        /* Clean Light Theme - Primary Colors */
        --bg-primary: #f8f9fa;
        --bg-secondary: #ffffff;
        --bg-tertiary: #f5f8fa;
        --bg-elevated: #ffffff;
        --bg-glass: rgba(248, 249, 250, 0.8);
        --bg-glass-hover: rgba(248, 249, 250, 1);
        
        /* Professional Text Colors */
        --text-primary: #181c32;
        --text-secondary: #5e6278;
        --text-tertiary: #a1a5b7;
        --text-disabled: #b5b5c3;
        
        /* Metronic Brand Colors */
        --brand-primary: #009ef7;
        --brand-secondary: #7239ea;
        --brand-gradient: linear-gradient(135deg, #009ef7, #7239ea);
        --brand-gradient-hover: linear-gradient(135deg, #0095e8, #6929d4);
        
        /* Professional Accent Colors */
        --accent-purple: #7239ea;
        --accent-blue: #009ef7;
        --accent-cyan: #00a3ff;
        --accent-pink: #e91e63;
        
        /* Status Colors */
        --success: #50cd89;
        --warning: #ffc700;
        --error: #f1416c;
        --info: #009ef7;
        
        /* Light Theme Border Colors */
        --border-primary: #eff2f5;
        --border-secondary: #e4e6ea;
        --border-tertiary: #d9dee3;
        --border-focus: #009ef7;
        
        /* 8-Point Grid System */
        --space-1: 8px;   /* 1 unit */
        --space-2: 16px;  /* 2 units */
        --space-3: 24px;  /* 3 units */
        --space-4: 32px;  /* 4 units */
        --space-5: 40px;  /* 5 units */
        --space-6: 48px;  /* 6 units */
        --space-7: 56px;  /* 7 units */
        --space-8: 64px;  /* 8 units */
        
        /* Typography Scale - Inter Font */
        --text-xs: 0.75rem;    /* 12px */
        --text-sm: 0.875rem;   /* 14px */
        --text-base: 1rem;     /* 16px */
        --text-lg: 1.125rem;   /* 18px */
        --text-xl: 1.25rem;    /* 20px */
        --text-2xl: 1.5rem;    /* 24px */
        --text-3xl: 2rem;      /* 32px */
        --text-4xl: 2.5rem;    /* 40px */
        
        /* Font Weights */
        --font-normal: 400;
        --font-medium: 500;
        --font-semibold: 600;
        --font-bold: 700;
        
        /* Professional Light Shadows */
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-base: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        
        /* Light Theme Glass Effect */
        --glass-blur: blur(10px);
        --glass-border: 1px solid rgba(228, 230, 234, 0.3);
        
        /* Border Radius - Modern Scale */
        --radius-xs: 4px;
        --radius-sm: 6px;
        --radius-md: 8px;
        --radius-lg: 12px;
        --radius-xl: 16px;
        --radius-2xl: 24px;
        
        /* Animation Timing */
        --duration-fast: 150ms;
        --duration-normal: 200ms;
        --duration-slow: 300ms;
        --ease: cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .sidebar-modern {
        position: fixed;
        top: 0;
        left: 0;
        z-index: 1000;
    }
    
    /* Professional Light Navigation */
    .sidebar-modern .nav-item:hover {
        background: rgba(255, 255, 255, 0.1) !important;
        color: #ffffff !important;
        transform: translateX(2px);
    }
    
    .sidebar-modern .nav-item:hover i {
        color: #ffffff !important;
    }
    
    .sidebar-modern .nav-item.nav-active {
        background: rgba(0, 158, 247, 0.2) !important;
        color: #ffffff !important;
        border-left: 3px solid var(--brand-primary);
        position: relative;
    }
    
    .sidebar-modern .nav-item.nav-active i {
        color: #ffffff !important;
    }
    
    .brand-icon {
        animation: subtle-float 3s ease-in-out infinite;
    }
    
    @keyframes subtle-float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-2px); }
    }
    
    .topbar-modern {
        margin-left: 240px;
    }
    
    .content-area {
        margin-left: 240px;
    }
    
    /* Mobile responsive adjustments */
    @media (max-width: 991.98px) {
        .mobile-menu-toggle {
            min-width: 44px !important;
            min-height: 44px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            touch-action: manipulation !important;
        }
        
        .mobile-menu-toggle:hover,
        .mobile-menu-toggle:active {
            background: rgba(255, 255, 255, 0.1) !important;
            border-radius: 6px !important;
        }
        
        /* Mobile content adjustments */
        .mobile-content {
            display: block !important;
            visibility: visible !important;
        }
        
        /* Mobile card adjustments */
        .card-modern {
            margin-bottom: 16px !important;
        }
        
        .card-header-modern {
            padding: 12px 16px !important;
        }
        
        .card-body-modern {
            padding: 16px !important;
        }
    }
    
    /* Tablet specific adjustments */
    @media screen and (max-width: 768px) {
        .mobile-header {
            padding: 8px 16px !important;
        }
        
        .mobile-content {
            padding: 12px !important;
            margin-top: 60px !important;
        }
    }
    
    @media (max-width: 575.98px) {
        .mobile-content {
            padding: 8px !important;
        }
        
        /* Mobile metric cards */
        .card-modern.card-body-modern {
            padding: 12px !important;
        }
        
        /* Mobile table improvements */
        .table {
            font-size: 13px !important;
        }
        
        .table td {
            padding: 12px 16px !important;
        }
        
        /* Mobile buttons */
        .btn {
            font-size: 13px !important;
        }
        
        .btn-sm {
            font-size: 12px !important;
            padding: 6px 8px !important;
        }
    }
    
    .avatar-circle {
        font-size: 12px;
        background: var(--brand-gradient) !important;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border-primary);
    }
    
    .dropdown-menu {
        border: 1px solid var(--border-primary);
        border-radius: 6px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        padding: 8px 0;
        background: var(--bg-secondary);
    }
    
    .dropdown-item {
        padding: 8px 16px;
        font-size: 14px;
        font-weight: 500;
        color: var(--text-secondary);
        border-radius: 4px;
        margin: 2px 8px;
        transition: all 0.15s ease;
    }
    
    .dropdown-item:hover {
        background-color: var(--bg-tertiary);
        color: var(--text-primary);
    }
    
    /* Linear-Style Typography Hierarchy */
    h1 { font-size: var(--text-3xl); font-weight: var(--font-bold); color: var(--text-primary); line-height: 1.2; letter-spacing: -0.025em; }
    h2 { font-size: var(--text-2xl); font-weight: var(--font-semibold); color: var(--text-primary); line-height: 1.3; letter-spacing: -0.025em; }
    h3 { font-size: var(--text-xl); font-weight: var(--font-semibold); color: var(--text-primary); line-height: 1.4; }
    h4 { font-size: var(--text-lg); font-weight: var(--font-semibold); color: var(--text-primary); line-height: 1.4; }
    h5 { font-size: var(--text-base); font-weight: var(--font-medium); color: var(--text-primary); line-height: 1.5; }
    h6 { font-size: var(--text-sm); font-weight: var(--font-medium); color: var(--text-primary); line-height: 1.5; }
    
    .text-body { font-size: var(--text-base); font-weight: var(--font-normal); color: var(--text-secondary); line-height: 1.6; }
    .text-small { font-size: var(--text-sm); font-weight: var(--font-normal); color: var(--text-secondary); line-height: 1.5; }
    .text-tiny { font-size: var(--text-xs); font-weight: var(--font-normal); color: var(--text-tertiary); line-height: 1.4; }
    
    .text-muted { color: var(--text-tertiary) !important; }
    .text-primary { color: var(--brand-primary) !important; }
    .text-success { color: var(--success) !important; }
    
    /* Metronic Professional Cards */
    .card-modern {
        background: var(--bg-elevated);
        border: 1px solid var(--border-primary);
        border-radius: 6px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        transition: all 0.15s ease;
        overflow: hidden;
    }
    
    .card-modern:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        transform: translateY(-1px);
        border-color: var(--border-secondary);
    }
    
    .card-header-modern {
        background: var(--bg-elevated);
        border-bottom: 1px solid var(--border-primary);
        padding: 16px 20px;
        border-radius: 6px 6px 0 0;
    }
    
    .card-body-modern {
        padding: 20px;
        background: var(--bg-elevated);
    }
    
    .card-footer-modern {
        background: var(--bg-tertiary);
        border-top: 1px solid var(--border-primary);
        padding: 12px 20px;
        border-radius: 0 0 6px 6px;
    }
    
    /* Metronic Professional Buttons */
    .btn-primary-modern {
        background: var(--brand-primary);
        border: none;
        border-radius: 6px;
        font-weight: 600;
        padding: 8px 16px;
        font-size: 13px;
        color: white;
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        transition: all 0.15s ease;
        height: 36px;
        line-height: 1.2;
    }
    
    .btn-primary-modern:hover {
        background: #0095e8;
        transform: translateY(-1px);
        box-shadow: 0 3px 8px rgba(0, 158, 247, 0.3);
        color: white;
    }
    
    .btn-secondary-modern {
        background: var(--bg-elevated);
        border: 1px solid var(--border-secondary);
        color: var(--text-secondary);
        border-radius: 6px;
        font-weight: 600;
        padding: 8px 16px;
        font-size: 13px;
        transition: all 0.15s ease;
        height: 36px;
        line-height: 1.2;
    }
    
    .btn-secondary-modern:hover {
        background: var(--bg-tertiary);
        color: var(--text-primary);
        border-color: var(--border-tertiary);
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .btn-success-modern {
        background: var(--success);
        border: none;
        border-radius: var(--radius-lg);
        font-weight: var(--font-semibold);
        padding: var(--space-3) var(--space-6);
        font-size: var(--text-sm);
        color: var(--text-primary);
        box-shadow: var(--shadow-md);
        transition: all var(--duration-normal) var(--ease);
    }
    
    .btn-success-modern:hover {
        background: #059669;
        transform: translateY(-1px);
        box-shadow: var(--shadow-lg);
    }
    
    /* Input Styles */
    .form-control-modern {
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 12px 16px;
        font-size: 14px;
        transition: all 0.2s ease;
    }
    
    .form-control-modern:focus {
        border-color: var(--primary-orange);
        box-shadow: 0 0 0 3px rgba(255,120,73,0.1);
    }
    
    /* Mobile Responsive */
    @media (max-width: 991.98px) {
        .sidebar-modern {
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        
        .sidebar-modern.show {
            transform: translateX(0);
        }
        
        .topbar-modern {
            margin-left: 0;
        }
        
        .content-area {
            margin-left: 0;
        }
    }
</style>

<!-- Modern Interactions Script -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Ensure proper layout detection
        function ensureProperLayout() {
            const isMobile = window.innerWidth <= 991 || 
                           /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
                           ('ontouchstart' in window) ||
                           (navigator.maxTouchPoints > 0);
            
            const mobileContent = document.querySelector('.mobile-content');
            const desktopLayout = document.querySelector('.d-none.d-lg-flex');
            const mobileHeader = document.querySelector('.mobile-header');
            
            if (isMobile) {
                // Force show mobile content
                if (mobileContent) {
                    mobileContent.style.display = 'block';
                    mobileContent.style.visibility = 'visible';
                }
                if (mobileHeader) {
                    mobileHeader.style.display = 'block';
                    mobileHeader.style.visibility = 'visible';
                }
                // Force hide desktop layout
                if (desktopLayout) {
                    desktopLayout.style.display = 'none';
                }
            } else {
                // Force show desktop layout
                if (desktopLayout) {
                    desktopLayout.style.display = 'flex';
                }
                // Force hide mobile content
                if (mobileContent) {
                    mobileContent.style.display = 'none';
                }
                if (mobileHeader) {
                    mobileHeader.style.display = 'none';
                }
            }
        }
        
        // Run on load and resize
        ensureProperLayout();
        window.addEventListener('resize', ensureProperLayout);
        window.addEventListener('orientationchange', function() {
            setTimeout(ensureProperLayout, 100);
        });
        // Command Palette Implementation
        const commandPalette = document.getElementById('commandPalette');
        const commandInput = document.getElementById('commandInput');
        const commandResults = document.getElementById('commandResults');
        
        const commands = [
            { title: 'Dashboard', icon: 'fas fa-home', url: '{{ url_for("dashboard") }}', category: 'Navigation' },
            { title: 'Users', icon: 'fas fa-users', url: '{{ url_for("users") }}', category: 'Administration' },
            { title: 'Create User', icon: 'fas fa-plus', url: '{{ url_for("create_user") }}', category: 'Actions' },
            { title: 'Logout', icon: 'fas fa-sign-out-alt', url: '{{ url_for("logout") }}', category: 'Account' }
        ];

        // Cmd+K / Ctrl+K to open command palette
        document.addEventListener('keydown', function(e) {
            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                e.preventDefault();
                const modal = new bootstrap.Modal(commandPalette);
                modal.show();
                setTimeout(() => commandInput.focus(), 100);
            }
            
            // ESC to close
            if (e.key === 'Escape' && commandPalette.classList.contains('show')) {
                const modal = bootstrap.Modal.getInstance(commandPalette);
                if (modal) modal.hide();
            }
        });

        // Fuzzy search and render results
        function renderCommands(filteredCommands) {
            if (filteredCommands.length === 0) {
                commandResults.innerHTML = '<div style="padding: var(--space-6); text-align: center; color: var(--text-tertiary);">No commands found</div>';
                return;
            }

            const html = filteredCommands.map((cmd, index) => `
                <div class="command-item" data-url="${cmd.url}" style="padding: var(--space-3) var(--space-6); border-bottom: 1px solid var(--border-primary); cursor: pointer; transition: all var(--duration-fast) var(--ease); ${index === 0 ? 'background: var(--bg-glass);' : ''}">
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center">
                            <i class="${cmd.icon}" style="color: var(--text-secondary); margin-right: var(--space-3); width: 16px;"></i>
                            <span style="color: var(--text-primary); font-weight: var(--font-medium);">${cmd.title}</span>
                        </div>
                        <span style="color: var(--text-tertiary); font-size: var(--text-xs);">${cmd.category}</span>
                    </div>
                </div>
            `).join('');
            
            commandResults.innerHTML = html;

            // Add click handlers
            document.querySelectorAll('.command-item').forEach(item => {
                item.addEventListener('click', () => {
                    window.location.href = item.dataset.url;
                });
                
                item.addEventListener('mouseenter', () => {
                    document.querySelectorAll('.command-item').forEach(el => el.style.background = 'transparent');
                    item.style.background = 'var(--bg-glass)';
                });
            });
        }

        // Initial render and search
        if (commandInput) {
            renderCommands(commands);
            
            commandInput.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                const filtered = commands.filter(cmd => 
                    cmd.title.toLowerCase().includes(query) || 
                    cmd.category.toLowerCase().includes(query)
                );
                renderCommands(filtered);
            });
        }

        // Mobile Menu Toggle
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.querySelector('.sidebar-modern');
        
        if (sidebarToggle && sidebar) {
            sidebarToggle.addEventListener('click', function() {
                sidebar.classList.toggle('show');
            });
            
            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', function(e) {
                if (window.innerWidth <= 991.98) {
                    if (!sidebar.contains(e.target) && !sidebarToggle.contains(e.target)) {
                        sidebar.classList.remove('show');
                    }
                }
            });
        }
    });
</script>
{% endblock %}